# Chapter 10.3: Metadata & SEO

## Overview

Metadata controls how your pages appear in search results and social media shares. Next.js provides a powerful metadata API for static and dynamic metadata, Open Graph images, and structured data.

## Static Metadata

Export a `metadata` object from layout or page files:

```tsx
// app/layout.tsx
import type { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'My Website',
  description: 'Welcome to my website',
};
```

```tsx
// app/about/page.tsx
import type { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'About Us',
  description: 'Learn more about our company',
};
```

## Common Metadata Fields

```tsx
import type { Metadata } from 'next';

export const metadata: Metadata = {
  // Basic
  title: 'My Website',
  description: 'A description of my website',
  keywords: ['Next.js', 'React', 'TypeScript'],
  authors: [{ name: 'John Doe', url: 'https://johndoe.com' }],
  creator: 'John Doe',
  publisher: 'My Company',

  // Icons
  icons: {
    icon: '/favicon.ico',
    shortcut: '/favicon-16x16.png',
    apple: '/apple-touch-icon.png',
  },

  // Robots
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      'max-video-preview': -1,
      'max-image-preview': 'large',
      'max-snippet': -1,
    },
  },

  // Canonical URL
  alternates: {
    canonical: 'https://example.com',
  },
};
```

## Template Titles

Create consistent title patterns with templates:

```tsx
// app/layout.tsx
export const metadata: Metadata = {
  title: {
    template: '%s | My Website',  // %s is replaced by page title
    default: 'My Website',         // Used when page has no title
  },
};
```

```tsx
// app/about/page.tsx
export const metadata: Metadata = {
  title: 'About',  // Renders: "About | My Website"
};
```

```tsx
// app/blog/page.tsx
export const metadata: Metadata = {
  title: {
    absolute: 'Blog - Custom Title',  // Ignores template
  },
};
```

## Dynamic Metadata

Use `generateMetadata` for dynamic content:

```tsx
// app/blog/[slug]/page.tsx
import type { Metadata } from 'next';

type Props = {
  params: Promise<{ slug: string }>;
};

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const { slug } = await params;
  const post = await getPost(slug);

  if (!post) {
    return {
      title: 'Not Found',
    };
  }

  return {
    title: post.title,
    description: post.excerpt,
    authors: [{ name: post.author.name }],
    openGraph: {
      title: post.title,
      description: post.excerpt,
      type: 'article',
      publishedTime: post.publishedAt,
      authors: [post.author.name],
      images: [post.coverImage],
    },
  };
}
```

## Open Graph Metadata

Control how pages appear when shared on social media:

```tsx
export const metadata: Metadata = {
  openGraph: {
    title: 'My Website',
    description: 'Welcome to my website',
    url: 'https://example.com',
    siteName: 'My Website',
    locale: 'en_US',
    type: 'website',
    images: [
      {
        url: 'https://example.com/og.jpg',
        width: 1200,
        height: 630,
        alt: 'My Website',
      },
    ],
  },
};
```

### Article Metadata

```tsx
export const metadata: Metadata = {
  openGraph: {
    type: 'article',
    publishedTime: '2024-01-15T00:00:00.000Z',
    modifiedTime: '2024-01-20T00:00:00.000Z',
    authors: ['John Doe'],
    tags: ['Next.js', 'React'],
  },
};
```

## Twitter Card Metadata

```tsx
export const metadata: Metadata = {
  twitter: {
    card: 'summary_large_image',
    title: 'My Website',
    description: 'Welcome to my website',
    creator: '@johndoe',
    images: ['https://example.com/og.jpg'],
  },
};
```

## File-Based Metadata

Place special files in the `app` directory:

```
app/
├── favicon.ico          → Favicon
├── icon.png             → App icon
├── icon.svg             → SVG icon
├── apple-icon.png       → Apple touch icon
├── opengraph-image.png  → Default OG image
├── twitter-image.png    → Default Twitter image
├── sitemap.ts           → Sitemap generator
└── robots.ts            → Robots.txt generator
```

### Dynamic OG Images

Generate images at build/request time:

```tsx
// app/blog/[slug]/opengraph-image.tsx
import { ImageResponse } from 'next/og';

export const runtime = 'edge';
export const alt = 'Blog Post';
export const size = { width: 1200, height: 630 };
export const contentType = 'image/png';

export default async function Image({ params }: { params: { slug: string } }) {
  const post = await getPost(params.slug);

  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 48,
          background: 'linear-gradient(to bottom, #1a1a2e, #16213e)',
          color: 'white',
          width: '100%',
          height: '100%',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          padding: 48,
        }}
      >
        <div style={{ fontSize: 64, fontWeight: 'bold', marginBottom: 24 }}>
          {post.title}
        </div>
        <div style={{ fontSize: 32, opacity: 0.8 }}>
          {post.author.name}
        </div>
      </div>
    ),
    { ...size }
  );
}
```

## Sitemap Generation

```tsx
// app/sitemap.ts
import type { MetadataRoute } from 'next';

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const posts = await getAllPosts();

  const postUrls = posts.map((post) => ({
    url: `https://example.com/blog/${post.slug}`,
    lastModified: post.updatedAt,
    changeFrequency: 'weekly' as const,
    priority: 0.8,
  }));

  return [
    {
      url: 'https://example.com',
      lastModified: new Date(),
      changeFrequency: 'yearly',
      priority: 1,
    },
    {
      url: 'https://example.com/about',
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 0.5,
    },
    ...postUrls,
  ];
}
```

## Robots.txt Generation

```tsx
// app/robots.ts
import type { MetadataRoute } from 'next';

export default function robots(): MetadataRoute.Robots {
  return {
    rules: [
      {
        userAgent: '*',
        allow: '/',
        disallow: ['/admin/', '/api/'],
      },
    ],
    sitemap: 'https://example.com/sitemap.xml',
  };
}
```

## JSON-LD Structured Data

Add structured data for rich search results:

```tsx
// app/blog/[slug]/page.tsx
export default async function BlogPost({ params }: Props) {
  const { slug } = await params;
  const post = await getPost(slug);

  const jsonLd = {
    '@context': 'https://schema.org',
    '@type': 'BlogPosting',
    headline: post.title,
    description: post.excerpt,
    image: post.coverImage,
    datePublished: post.publishedAt,
    dateModified: post.updatedAt,
    author: {
      '@type': 'Person',
      name: post.author.name,
    },
  };

  return (
    <>
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
      />
      <article>
        <h1>{post.title}</h1>
        <p>{post.content}</p>
      </article>
    </>
  );
}
```

### Common Schema Types

```tsx
// Organization
const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: 'My Company',
  url: 'https://example.com',
  logo: 'https://example.com/logo.png',
  sameAs: [
    'https://twitter.com/mycompany',
    'https://linkedin.com/company/mycompany',
  ],
};

// Product
const productSchema = {
  '@context': 'https://schema.org',
  '@type': 'Product',
  name: 'Product Name',
  image: 'https://example.com/product.jpg',
  description: 'Product description',
  offers: {
    '@type': 'Offer',
    price: '99.99',
    priceCurrency: 'USD',
    availability: 'https://schema.org/InStock',
  },
};

// FAQ
const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: [
    {
      '@type': 'Question',
      name: 'What is Next.js?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'Next.js is a React framework...',
      },
    },
  ],
};
```

## Examples

### Basic Example: Static Page

```tsx
// app/contact/page.tsx
import type { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'Contact Us',
  description: 'Get in touch with our team',
  openGraph: {
    title: 'Contact Us',
    description: 'Get in touch with our team',
  },
};

export default function ContactPage() {
  return (
    <div>
      <h1>Contact Us</h1>
      {/* Contact form */}
    </div>
  );
}
```

### Normal Example: Product Page

```tsx
// app/products/[id]/page.tsx
import type { Metadata } from 'next';

type Props = {
  params: Promise<{ id: string }>;
};

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const { id } = await params;
  const product = await getProduct(id);

  return {
    title: product.name,
    description: product.description,
    openGraph: {
      title: product.name,
      description: product.description,
      images: [product.image],
      type: 'website',
    },
  };
}

export default async function ProductPage({ params }: Props) {
  const { id } = await params;
  const product = await getProduct(id);

  const jsonLd = {
    '@context': 'https://schema.org',
    '@type': 'Product',
    name: product.name,
    description: product.description,
    image: product.image,
    offers: {
      '@type': 'Offer',
      price: product.price,
      priceCurrency: 'USD',
    },
  };

  return (
    <>
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
      />
      <div>
        <h1>{product.name}</h1>
        <p>{product.description}</p>
        <p>${product.price}</p>
      </div>
    </>
  );
}
```

## Key Takeaways

- Use `metadata` object for static metadata
- Use `generateMetadata` for dynamic content
- Template titles create consistent branding
- Open Graph controls social media appearance
- File-based icons are automatically picked up
- JSON-LD enables rich search results
- Generate sitemaps and robots.txt programmatically

## Questions & Answers

### Q: How does metadata inheritance work?
**A:** Metadata merges from root layout down. Page metadata overrides layout metadata for the same fields.

### Q: Can I have different OG images per page?
**A:** Yes, add `opengraph-image.tsx` in any route folder for route-specific OG images.

### Q: How do I test my metadata?
**A:** Use tools like [OpenGraph.xyz](https://www.opengraph.xyz/) or social platform debuggers (Facebook Sharing Debugger, Twitter Card Validator).

### Q: Should I add JSON-LD to every page?
**A:** Add it to pages where rich results make sense: products, articles, FAQs, events, organizations.

## Resources

- [Next.js: Metadata](https://nextjs.org/docs/app/building-your-application/optimizing/metadata)
- [Open Graph Protocol](https://ogp.me/)
- [Schema.org](https://schema.org/)
- [Google Rich Results Test](https://search.google.com/test/rich-results)

---

**Next Chapter:** [11. API Routes](./11-api-routes.md) - Create API endpoints with Route Handlers.
