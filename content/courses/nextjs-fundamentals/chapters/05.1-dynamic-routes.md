# Chapter 5.1: Dynamic Routes

## Overview

Dynamic routes let you create pages that respond to variable URL segments. Instead of creating a separate file for every blog post or product, you create one template that handles all of them.

## Single Dynamic Segments

Wrap a folder name in brackets to create a dynamic segment:

```
app/
└── blog/
    └── [slug]/
        └── page.tsx   →  /blog/hello-world, /blog/my-post
```

### Accessing Parameters

```tsx
// app/blog/[slug]/page.tsx
type Props = {
  params: Promise<{ slug: string }>;
};

export default async function BlogPost({ params }: Props) {
  const { slug } = await params;
  const post = await getPost(slug);

  return (
    <article>
      <h1>{post.title}</h1>
      <p>{post.content}</p>
    </article>
  );
}
```

In Next.js 15, `params` is a Promise that must be awaited.

## Multiple Dynamic Segments

Nest dynamic folders for multiple parameters:

```
app/
└── shop/
    └── [category]/
        └── [product]/
            └── page.tsx   →  /shop/electronics/iphone
```

```tsx
// app/shop/[category]/[product]/page.tsx
type Props = {
  params: Promise<{ category: string; product: string }>;
};

export default async function ProductPage({ params }: Props) {
  const { category, product } = await params;

  return (
    <div>
      <p>Category: {category}</p>
      <p>Product: {product}</p>
    </div>
  );
}
```

## Catch-All Routes

Match multiple segments with `[...param]`:

```
app/
└── docs/
    └── [...slug]/
        └── page.tsx
```

| URL | params.slug |
|-----|-------------|
| `/docs/a` | `['a']` |
| `/docs/a/b` | `['a', 'b']` |
| `/docs/a/b/c` | `['a', 'b', 'c']` |

```tsx
// app/docs/[...slug]/page.tsx
type Props = {
  params: Promise<{ slug: string[] }>;
};

export default async function DocsPage({ params }: Props) {
  const { slug } = await params;
  const path = slug.join('/');

  return <div>Viewing: {path}</div>;
}
```

**Note:** Catch-all routes do NOT match the base path (`/docs`). Use optional catch-all for that.

## Optional Catch-All Routes

Match zero or more segments with `[[...param]]`:

```
app/
└── shop/
    └── [[...categories]]/
        └── page.tsx
```

| URL | params.categories |
|-----|-------------------|
| `/shop` | `undefined` |
| `/shop/clothes` | `['clothes']` |
| `/shop/clothes/shirts` | `['clothes', 'shirts']` |

```tsx
// app/shop/[[...categories]]/page.tsx
type Props = {
  params: Promise<{ categories?: string[] }>;
};

export default async function ShopPage({ params }: Props) {
  const { categories } = await params;

  if (!categories) {
    return <div>All Products</div>;
  }

  return <div>Category: {categories.join(' > ')}</div>;
}
```

## Generating Static Params

For static generation, tell Next.js which dynamic routes to pre-render:

```tsx
// app/blog/[slug]/page.tsx
export async function generateStaticParams() {
  const posts = await getAllPosts();

  return posts.map((post) => ({
    slug: post.slug,
  }));
}

export default async function BlogPost({ params }: Props) {
  const { slug } = await params;
  // ...
}
```

### Multiple Segments

```tsx
// app/shop/[category]/[product]/page.tsx
export async function generateStaticParams() {
  const products = await getAllProducts();

  return products.map((product) => ({
    category: product.category,
    product: product.slug,
  }));
}
```

### Catch-All Static Params

```tsx
// app/docs/[...slug]/page.tsx
export async function generateStaticParams() {
  return [
    { slug: ['getting-started'] },
    { slug: ['getting-started', 'installation'] },
    { slug: ['api', 'reference'] },
  ];
}
```

## Dynamic Segments with Layouts

Dynamic segments work with layouts too:

```
app/
└── dashboard/
    └── [teamId]/
        ├── layout.tsx    ← Shared for all team pages
        ├── page.tsx      ← /dashboard/team-1
        ├── settings/
        │   └── page.tsx  ← /dashboard/team-1/settings
        └── members/
            └── page.tsx  ← /dashboard/team-1/members
```

```tsx
// app/dashboard/[teamId]/layout.tsx
type Props = {
  children: React.ReactNode;
  params: Promise<{ teamId: string }>;
};

export default async function TeamLayout({ children, params }: Props) {
  const { teamId } = await params;
  const team = await getTeam(teamId);

  return (
    <div>
      <nav>
        <h2>{team.name}</h2>
        <Link href={`/dashboard/${teamId}`}>Overview</Link>
        <Link href={`/dashboard/${teamId}/settings`}>Settings</Link>
        <Link href={`/dashboard/${teamId}/members`}>Members</Link>
      </nav>
      <main>{children}</main>
    </div>
  );
}
```

## Examples

### Basic Example: Blog Post

```tsx
// app/blog/[slug]/page.tsx
import { notFound } from 'next/navigation';

type Props = {
  params: Promise<{ slug: string }>;
};

export async function generateStaticParams() {
  const posts = await db.posts.findMany({ select: { slug: true } });
  return posts.map((post) => ({ slug: post.slug }));
}

export async function generateMetadata({ params }: Props) {
  const { slug } = await params;
  const post = await db.posts.findUnique({ where: { slug } });

  if (!post) return { title: 'Not Found' };

  return { title: post.title, description: post.excerpt };
}

export default async function BlogPost({ params }: Props) {
  const { slug } = await params;
  const post = await db.posts.findUnique({ where: { slug } });

  if (!post) notFound();

  return (
    <article>
      <h1>{post.title}</h1>
      <p>{post.content}</p>
    </article>
  );
}
```

### Normal Example: User Profile with Tabs

```tsx
// app/users/[username]/page.tsx
import { notFound } from 'next/navigation';

type Props = {
  params: Promise<{ username: string }>;
  searchParams: Promise<{ tab?: string }>;
};

export default async function UserProfile({ params, searchParams }: Props) {
  const { username } = await params;
  const { tab = 'posts' } = await searchParams;

  const user = await db.users.findUnique({
    where: { username },
    include: { posts: tab === 'posts', followers: tab === 'followers' },
  });

  if (!user) notFound();

  return (
    <div>
      <h1>@{user.username}</h1>
      <nav>
        <Link href={`/users/${username}?tab=posts`}>Posts</Link>
        <Link href={`/users/${username}?tab=followers`}>Followers</Link>
      </nav>
      {tab === 'posts' && <PostList posts={user.posts} />}
      {tab === 'followers' && <FollowerList followers={user.followers} />}
    </div>
  );
}
```

### Complex Example: Documentation with Catch-All

```tsx
// app/docs/[[...slug]]/page.tsx
import { notFound } from 'next/navigation';

type Props = {
  params: Promise<{ slug?: string[] }>;
};

export async function generateStaticParams() {
  const docs = await getAllDocPages();

  return [
    { slug: undefined }, // /docs
    ...docs.map((doc) => ({ slug: doc.path.split('/') })),
  ];
}

export default async function DocsPage({ params }: Props) {
  const { slug } = await params;
  const path = slug?.join('/') || 'index';

  const doc = await getDocByPath(path);

  if (!doc) notFound();

  return (
    <div className="docs-layout">
      <aside>
        <DocsNavigation currentPath={path} />
      </aside>
      <article>
        <h1>{doc.title}</h1>
        <MDXContent content={doc.content} />
      </article>
    </div>
  );
}
```

## Key Takeaways

- `[param]` creates a single dynamic segment
- `[...param]` catches all segments (one or more)
- `[[...param]]` optionally catches all segments (zero or more)
- Use `generateStaticParams` for static generation
- `params` is a Promise in Next.js 15 - always await it
- Dynamic segments work with layouts for shared UI

## Questions & Answers

### Q: When should I use catch-all vs optional catch-all?
**A:** Use `[...slug]` when the base path should show something different (or 404). Use `[[...slug]]` when the base path and nested paths share the same component.

### Q: Can I have both static and dynamic routes at the same level?
**A:** Yes. Static routes take precedence:
```
app/blog/[slug]/page.tsx  → /blog/anything
app/blog/featured/page.tsx → /blog/featured (takes precedence)
```

### Q: How do I validate dynamic parameters?
**A:** Validate in your page component and call `notFound()` for invalid params:
```tsx
const id = parseInt(params.id);
if (isNaN(id)) notFound();
```

### Q: Can dynamic routes be internationalized?
**A:** Yes, combine with route groups:
```
app/[locale]/blog/[slug]/page.tsx → /en/blog/hello, /fr/blog/bonjour
```

## Resources

- [Next.js: Dynamic Routes](https://nextjs.org/docs/app/building-your-application/routing/dynamic-routes)
- [Next.js: generateStaticParams](https://nextjs.org/docs/app/api-reference/functions/generate-static-params)

---

**Next:** [5.2 Parallel & Intercepting Routes](./05.2-parallel-intercepting-routes.md) - Advanced routing patterns for modals and split views.
