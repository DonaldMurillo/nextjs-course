# Chapter 9.1: CSS Modules

## Overview

CSS Modules provide component-scoped styling by automatically generating unique class names. This prevents style conflicts and makes your CSS modular and maintainable.

## How CSS Modules Work

Create a file with the `.module.css` extension:

```css
/* components/Button.module.css */
.button {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.primary {
  background: #0070f3;
  color: white;
}

.secondary {
  background: #eaeaea;
  color: #333;
}
```

Import and use the styles:

```jsx
// components/Button.js
import styles from './Button.module.css';

export function Button({ variant = 'primary', children }) {
  return (
    <button className={`${styles.button} ${styles[variant]}`}>
      {children}
    </button>
  );
}
```

The generated HTML will have unique class names:

```html
<button class="Button_button__abc123 Button_primary__def456">
  Click me
</button>
```

## Naming Conventions

### camelCase for Multi-Word Classes

```css
/* ❌ Avoid: kebab-case requires bracket notation */
.nav-item { }
.btn-primary { }

/* ✅ Prefer: camelCase for easy access */
.navItem { }
.btnPrimary { }
```

```jsx
// With kebab-case (awkward)
<div className={styles['nav-item']} />

// With camelCase (clean)
<div className={styles.navItem} />
```

### BEM-Like Structure

You can still use BEM methodology:

```css
/* components/Card.module.css */
.card { }
.cardHeader { }
.cardBody { }
.cardFooter { }
.cardTitle { }
.cardTitleLarge { }
```

## Composing Styles

### Using composes

CSS Modules support composition:

```css
/* styles/base.module.css */
.flex {
  display: flex;
}

.flexCenter {
  composes: flex;
  align-items: center;
  justify-content: center;
}

/* components/Modal.module.css */
.overlay {
  composes: flexCenter from '../styles/base.module.css';
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
}
```

### Multiple Classes

```jsx
import styles from './Component.module.css';

// Template literal
<div className={`${styles.base} ${styles.active}`} />

// Array join
<div className={[styles.base, styles.active].join(' ')} />

// Conditional
<div className={`${styles.button} ${isActive ? styles.active : ''}`} />
```

### Using clsx or classnames

For complex class logic:

```bash
npm install clsx
```

```jsx
import clsx from 'clsx';
import styles from './Button.module.css';

export function Button({ variant, size, disabled, className }) {
  return (
    <button
      className={clsx(
        styles.button,
        styles[variant],
        styles[size],
        { [styles.disabled]: disabled },
        className
      )}
    >
      Click me
    </button>
  );
}
```

## Global Styles in Modules

Use `:global` for global selectors within a module:

```css
/* components/Markdown.module.css */
.content {
  padding: 1rem;
}

/* Target global elements inside .content */
.content :global(h1) {
  font-size: 2rem;
  margin-bottom: 1rem;
}

.content :global(pre) {
  background: #f5f5f5;
  padding: 1rem;
  overflow-x: auto;
}

.content :global(.highlight) {
  background: yellow;
}
```

## Examples

### Basic Example: Simple Card

```css
/* components/Card.module.css */
.card {
  border: 1px solid #eaeaea;
  border-radius: 8px;
  padding: 1.5rem;
  transition: box-shadow 0.2s;
}

.card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.title {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.description {
  color: #666;
  line-height: 1.6;
}
```

```jsx
// components/Card.js
import styles from './Card.module.css';

export function Card({ title, description }) {
  return (
    <div className={styles.card}>
      <h3 className={styles.title}>{title}</h3>
      <p className={styles.description}>{description}</p>
    </div>
  );
}
```

### Normal Example: Button Variants

```css
/* components/Button.module.css */
.button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.625rem 1.25rem;
  font-size: 0.875rem;
  font-weight: 500;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}

.button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Variants */
.primary {
  background: #0070f3;
  color: white;
}

.primary:hover:not(:disabled) {
  background: #0060df;
}

.secondary {
  background: #eaeaea;
  color: #333;
}

.secondary:hover:not(:disabled) {
  background: #ddd;
}

.danger {
  background: #dc2626;
  color: white;
}

.danger:hover:not(:disabled) {
  background: #b91c1c;
}

/* Sizes */
.small {
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
}

.large {
  padding: 0.875rem 1.75rem;
  font-size: 1rem;
}

/* With icon */
.icon {
  margin-right: 0.5rem;
}
```

```jsx
// components/Button.js
import clsx from 'clsx';
import styles from './Button.module.css';

export function Button({ 
  variant = 'primary', 
  size = 'medium',
  icon,
  disabled,
  children,
  className,
  ...props 
}) {
  return (
    <button
      className={clsx(
        styles.button,
        styles[variant],
        size !== 'medium' && styles[size],
        className
      )}
      disabled={disabled}
      {...props}
    >
      {icon && <span className={styles.icon}>{icon}</span>}
      {children}
    </button>
  );
}
```

### Complex Example: Responsive Navigation

```css
/* components/Nav.module.css */
.nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 2rem;
  background: white;
  border-bottom: 1px solid #eaeaea;
}

.logo {
  font-size: 1.5rem;
  font-weight: 700;
  color: #333;
  text-decoration: none;
}

.links {
  display: flex;
  gap: 2rem;
  list-style: none;
  margin: 0;
  padding: 0;
}

.link {
  color: #666;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.2s;
}

.link:hover {
  color: #0070f3;
}

.linkActive {
  color: #0070f3;
}

.menuButton {
  display: none;
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.5rem;
}

/* Mobile styles */
@media (max-width: 768px) {
  .links {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    flex-direction: column;
    background: white;
    padding: 1rem;
    gap: 1rem;
    border-bottom: 1px solid #eaeaea;
  }

  .linksOpen {
    display: flex;
  }

  .menuButton {
    display: block;
  }
}
```

```jsx
// components/Nav.js
'use client';

import { useState } from 'react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import clsx from 'clsx';
import styles from './Nav.module.css';

const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/about', label: 'About' },
  { href: '/blog', label: 'Blog' },
  { href: '/contact', label: 'Contact' },
];

export function Nav() {
  const [isOpen, setIsOpen] = useState(false);
  const pathname = usePathname();

  return (
    <nav className={styles.nav}>
      <Link href="/" className={styles.logo}>
        MySite
      </Link>

      <button
        className={styles.menuButton}
        onClick={() => setIsOpen(!isOpen)}
        aria-label="Toggle menu"
      >
        {isOpen ? '✕' : '☰'}
      </button>

      <ul className={clsx(styles.links, isOpen && styles.linksOpen)}>
        {navLinks.map(({ href, label }) => (
          <li key={href}>
            <Link
              href={href}
              className={clsx(
                styles.link,
                pathname === href && styles.linkActive
              )}
              onClick={() => setIsOpen(false)}
            >
              {label}
            </Link>
          </li>
        ))}
      </ul>
    </nav>
  );
}
```

### Edge Case Example: Dynamic Theme Styles

```css
/* components/ThemeCard.module.css */
.card {
  padding: 2rem;
  border-radius: 12px;
  transition: all 0.3s;
}

/* Theme variations using CSS custom properties */
.light {
  --bg: #ffffff;
  --text: #333333;
  --border: #eaeaea;
}

.dark {
  --bg: #1a1a1a;
  --text: #ffffff;
  --border: #333333;
}

.ocean {
  --bg: #e0f7fa;
  --text: #006064;
  --border: #80deea;
}

.forest {
  --bg: #e8f5e9;
  --text: #1b5e20;
  --border: #81c784;
}

.card {
  background: var(--bg);
  color: var(--text);
  border: 1px solid var(--border);
}
```

```jsx
// components/ThemeCard.js
import clsx from 'clsx';
import styles from './ThemeCard.module.css';

export function ThemeCard({ theme = 'light', children }) {
  return (
    <div className={clsx(styles.card, styles[theme])}>
      {children}
    </div>
  );
}
```

## Best Practices

### 1. One Module Per Component

```
components/
├── Button/
│   ├── Button.js
│   └── Button.module.css
├── Card/
│   ├── Card.js
│   └── Card.module.css
```

### 2. Keep Selectors Simple

```css
/* ✅ Good: Simple, flat selectors */
.button { }
.buttonPrimary { }
.buttonDisabled { }

/* ❌ Avoid: Deep nesting */
.wrapper .container .button { }
```

### 3. Use CSS Variables for Theming

```css
/* styles/variables.css */
:root {
  --color-primary: #0070f3;
  --color-text: #333;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
}

/* Component uses variables */
.button {
  background: var(--color-primary);
  padding: var(--spacing-sm) var(--spacing-md);
}
```

## Key Takeaways

- CSS Modules automatically scope styles to components
- Use `.module.css` extension for CSS Module files
- Prefer camelCase for class names
- Use `clsx` or `classnames` for conditional classes
- Use `:global()` sparingly for global overrides
- Compose styles with `composes` keyword

## Questions & Answers

### Q: Can I use Sass with CSS Modules?
**A:** Yes! Name your file `.module.scss` and install `sass`:
```bash
npm install sass
```

### Q: How do I share styles between modules?
**A:** Use `composes` or create shared CSS variable files.

### Q: Why are my styles not applying?
**A:** Check that you're using the correct import and class name. Remember class names are transformed.

## Resources

- [Next.js: CSS Modules](https://nextjs.org/docs/app/building-your-application/styling/css-modules)
- [CSS Modules GitHub](https://github.com/css-modules/css-modules)
- [clsx](https://github.com/lukeed/clsx)

---

**Next:** [9.2 Tailwind CSS](./09.2-tailwind-css.md) - Utility-first styling with Tailwind.
